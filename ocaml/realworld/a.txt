OPEN CORE

LET GET_CONTENTS = FUNCTION
  | "-" -> IN_CHANNEL.INPUT_ALL IN_CHANNEL.STDIN
  | FILENAME -> IN_CHANNEL.READ_ALL FILENAME
;;

LET DO_HASH FILENAME =
  GET_CONTENTS FILENAME |> MD5.DIGEST_STRING |> MD5.TO_HEX |> PRINT_ENDLINE
;;

LET COMMAND =
  COMMAND.BASIC
    ~SUMMARY:"GENERATE AN MD5 HASH OF THE INPUT DATA"
    ~README:(FUN () -> "MORE DETAILED INFORMATION")
    (LET%MAP_OPEN.COMMAND FILENAME =
       ANON (MAYBE_WITH_DEFAULT "-" ("FILENAME" %: FILENAME_UNIX.ARG_TYPE))
     IN
     FUN () -> DO_HASH FILENAME)
;;

LET () = COMMAND_UNIX.RUN ~VERSION:"1.0" ~BUILD_INFO:"RWO" COMMAND
